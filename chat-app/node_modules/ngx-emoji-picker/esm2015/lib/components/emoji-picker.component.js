/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, EventEmitter, Output, ElementRef, Renderer } from '@angular/core';
import { DIRECTIONS } from '../misc/picker-directions';
import { Subject } from 'rxjs';
import { takeUntil, debounceTime } from 'rxjs/operators';
export class EmojiPickerComponent {
    /**
     * @param {?} _renderer
     * @param {?} _el
     */
    constructor(_renderer, _el) {
        this._renderer = _renderer;
        this._el = _el;
        this.selectionEmitter = new EventEmitter();
        this.pickerCloseEmitter = new EventEmitter();
        this._windowResize = new Subject();
        this._destroyed = new Subject();
        this._windowResize
            .pipe(takeUntil(this._destroyed), debounceTime(100))
            .subscribe(event => {
            this.setPosition(this._currentTarget, this._currentDirection);
        });
    }
    /**
     * @param {?} target
     * @param {?=} directionCode
     * @return {?}
     */
    setPosition(target, directionCode = DIRECTIONS.bottom) {
        if (!target) {
            return console.error('Emoji-Picker: positioning failed due to missing target element or direction code');
        }
        this._renderer.setElementStyle(this._el.nativeElement, 'transform', '');
        /** Store anchor and direction */
        this._currentTarget = target;
        this._currentDirection = directionCode;
        /** @type {?} */
        const targetBorders = target.nativeElement.getBoundingClientRect();
        /** @type {?} */
        const thisBorders = this._el.nativeElement.getBoundingClientRect();
        /** @type {?} */
        let heightCorrection = 0;
        /** @type {?} */
        let widthCorrection = 0;
        /** Setting up centering of picker for all cases */
        switch (this._currentDirection) {
            case DIRECTIONS.top:
            case DIRECTIONS.bottom:
                widthCorrection = targetBorders.left - thisBorders.left + (targetBorders.width - thisBorders.width) / 2;
                break;
            case DIRECTIONS.left:
            case DIRECTIONS.right:
                heightCorrection = targetBorders.top - thisBorders.top + (targetBorders.height - thisBorders.height) / 2;
                break;
        }
        /** Setting up relative positioning for all cases */
        switch (this._currentDirection) {
            case DIRECTIONS.top:
                heightCorrection = targetBorders.top - thisBorders.bottom;
                break;
            case DIRECTIONS.left:
                widthCorrection = targetBorders.left - thisBorders.right;
                break;
            case DIRECTIONS.right:
                widthCorrection = targetBorders.right - thisBorders.left;
                break;
            case DIRECTIONS.bottom:
                heightCorrection = targetBorders.bottom - thisBorders.top;
                break;
        }
        /** Correcting positioning due to overflow problems */
        if (thisBorders.bottom + heightCorrection > window.innerHeight) {
            heightCorrection += window.innerHeight - (thisBorders.bottom + heightCorrection);
        }
        if (thisBorders.top + heightCorrection < 0) {
            heightCorrection -= (thisBorders.top + heightCorrection);
        }
        if (thisBorders.right + widthCorrection > window.innerWidth) {
            widthCorrection += window.innerWidth - (thisBorders.right + widthCorrection);
        }
        if (thisBorders.left + widthCorrection < 0) {
            widthCorrection -= (thisBorders.left + widthCorrection);
        }
        /** set the position adjustments to the emoji picker element */
        this._renderer.setElementStyle(this._el.nativeElement, 'transform', `translate(${widthCorrection}px,${heightCorrection}px)`);
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onBackground(event) {
        /** internal mousedowns are ignored */
        if (event === this._lastHostMousedownEvent || event.emojiPickerExempt) {
            return;
        }
        this.pickerCloseEmitter.emit(event);
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this._destroyed.next(true);
    }
}
EmojiPickerComponent.decorators = [
    { type: Component, args: [{
                selector: 'emoji-picker',
                template: `
  <emoji-content (emoji-selection)="selectionEmitter.emit($event)"></emoji-content>
  `,
                host: {
                    '(document:click)': 'onBackground($event)',
                    '(click)': '_lastHostMousedownEvent = $event',
                    '(window:resize)': '_windowResize.next($event)'
                },
                styles: [':host { position: absolute; z-index: 9999; }']
            }] }
];
/** @nocollapse */
EmojiPickerComponent.ctorParameters = () => [
    { type: Renderer },
    { type: ElementRef }
];
EmojiPickerComponent.propDecorators = {
    selectionEmitter: [{ type: Output, args: ['emoji-select',] }],
    pickerCloseEmitter: [{ type: Output, args: ['picker-close',] }]
};
if (false) {
    /** @type {?} */
    EmojiPickerComponent.prototype.selectionEmitter;
    /** @type {?} */
    EmojiPickerComponent.prototype.pickerCloseEmitter;
    /** @type {?} */
    EmojiPickerComponent.prototype._lastHostMousedownEvent;
    /** @type {?} */
    EmojiPickerComponent.prototype._currentTarget;
    /** @type {?} */
    EmojiPickerComponent.prototype._currentDirection;
    /** @type {?} */
    EmojiPickerComponent.prototype._windowResize;
    /** @type {?} */
    EmojiPickerComponent.prototype._destroyed;
    /**
     * @type {?}
     * @private
     */
    EmojiPickerComponent.prototype._renderer;
    /**
     * @type {?}
     * @private
     */
    EmojiPickerComponent.prototype._el;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW1vamktcGlja2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1lbW9qaS1waWNrZXIvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9lbW9qaS1waWNrZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN0RixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDdkQsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBa0J4RCxNQUFNLE9BQU8sb0JBQW9COzs7OztJQVcvQixZQUFvQixTQUFtQixFQUFVLEdBQWU7UUFBNUMsY0FBUyxHQUFULFNBQVMsQ0FBVTtRQUFVLFFBQUcsR0FBSCxHQUFHLENBQVk7UUFWeEMscUJBQWdCLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUN0Qyx1QkFBa0IsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBTXpELGtCQUFhLEdBQUcsSUFBSSxPQUFPLEVBQU8sQ0FBQztRQUNuQyxlQUFVLEdBQUcsSUFBSSxPQUFPLEVBQVcsQ0FBQztRQUd6QyxJQUFJLENBQUMsYUFBYTthQUNmLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQzthQUNuRCxTQUFTLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDakIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBQ2hFLENBQUMsQ0FBQyxDQUFBO0lBQ04sQ0FBQzs7Ozs7O0lBRUQsV0FBVyxDQUFDLE1BQWtCLEVB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LGVBQWUsQ0FBQyxDQUFDO1NBQ3pEO1FBRUQsK0RBQStEO1FBQy9ELElBQUksQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLFdBQVcsRUFBRSxhQUFhLGVBQWUsTUFBTSxnQkFBZ0IsS0FBSyxDQUFDLENBQUM7SUFDL0gsQ0FBQzs7Ozs7SUFFRCxZQUFZLENBQUMsS0FBSztRQUNoQixzQ0FBc0M7UUFDdEMsSUFBSSxLQUFLLEtBQUssSUFBSSxDQUFDLHVCQUF1QixJQUFJLEtBQUssQ0FBQyxpQkFBaUIsRUFBRTtZQUNyRSxPQUFPO1NBQ1I7UUFFRCxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3RDLENBQUM7Ozs7SUFFRCxXQUFXO1FBQ1QsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDN0IsQ0FBQzs7O1lBNUdGLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsY0FBYztnQkFFeEIsUUFBUSxFQUFFOztHQUVUO2dCQUNELElBQUksRUFBRTtvQkFDSixrQkFBa0IsRUFBRSxzQkFBc0I7b0JBQzFDLFNBQVMsRUFBRSxrQ0FBa0M7b0JBQzdDLGlCQUFpQixFQUFFLDRCQUE0QjtpQkFDaEQ7eUJBUlEsOENBQThDO2FBU3hEOzs7O1lBbkJxRCxRQUFRO1lBQXBCLFVBQVU7OzsrQkFzQmpELE1BQU0sU0FBQyxjQUFjO2lDQUNyQixNQUFNLFNBQUMsY0FBYzs7OztJQUR0QixnREFBOEQ7O0lBQzlELGtEQUFnRTs7SUFFaEUsdURBQStCOztJQUMvQiw4Q0FBa0M7O0lBQ2xDLGlEQUFxQzs7SUFFckMsNkNBQTBDOztJQUMxQywwQ0FBMkM7Ozs7O0lBRS9CLHlDQUEyQjs7Ozs7SUFBRSxtQ0FBdUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBFbGVtZW50UmVmLCBSZW5kZXJlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRElSRUNUSU9OUyB9IGZyb20gJy4uL21pc2MvcGlja2VyLWRpcmVjdGlvbnMnO1xuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgdGFrZVVudGlsLCBkZWJvdW5jZVRpbWV9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuXG5cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnZW1vamktcGlja2VyJyxcbiAgc3R5bGVzOiBbJzpob3N0IHsgcG9zaXRpb246IGFic29sdXRlOyB6LWluZGV4OiA5OTk5OyB9J10sXG4gIHRlbXBsYXRlOiBgXG4gIDxlbW9qaS1jb250ZW50IChlbW9qaS1zZWxlY3Rpb24pPVwic2VsZWN0aW9uRW1pdHRlci5lbWl0KCRldmVudClcIj48L2Vtb2ppLWNvbnRlbnQ+XG4gIGAsXG4gIGhvc3Q6IHtcbiAgICAnKGRvY3VtZW50OmNsaWNrKSc6ICdvbkJhY2tncm91bmQoJGV2ZW50KScsXG4gICAgJyhjbGljayknOiAnX2xhc3RIb3N0TW91c2Vkb3duRXZlbnQgPSAkZXZlbnQnLFxuICAgICcod2luZG93OnJlc2l6ZSknOiAnX3dpbmRvd1Jlc2l6ZS5uZXh0KCRldmVudCknXG4gIH1cbn0pXG5cbmV4cG9ydCBjbGFzcyBFbW9qaVBpY2tlckNvbXBvbmVudCB7XG4gIEBPdXRwdXQoJ2Vtb2ppLXNlbGVjdCcpIHNlbGVjdGlvbkVtaXR0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBPdXRwdXQoJ3BpY2tlci1jbG9zZScpIHBpY2tlckNsb3NlRW1pdHRlciA9IG5ldyBFdmVudEVtaXR0ZXIoKTsgXG5cbiAgcHVibGljIF9sYXN0SG9zdE1vdXNlZG93bkV2ZW50O1xuICBwdWJsaWMgX2N1cnJlbnRUYXJnZXQ6IEVsZW1lbnRSZWY7XG4gIHB1YmxpYyBfY3VycmVudERpcmVjdGlvbjogRElSRUNUSU9OUztcblxuICBwdWJsaWMgX3dpbmRvd1Jlc2l6ZSA9IG5ldyBTdWJqZWN0PGFueT4oKTtcbiAgcHVibGljIF9kZXN0cm95ZWQgPSBuZXcgU3ViamVjdDxib29sZWFuPigpO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgX3JlbmRlcmVyOiBSZW5kZXJlciwgcHJpdmF0ZSBfZWw6IEVsZW1lbnRSZWYpIHtcbiAgICB0aGlzLl93aW5kb3dSZXNpemVcbiAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLl9kZXN0cm95ZWQpLCBkZWJvdW5jZVRpbWUoMTAwKSlcbiAgICAgIC5zdWJzY3JpYmUoZXZlbnQgPT4ge1xuICAgICAgICB0aGlzLnNldFBvc2l0aW9uKHRoaXMuX2N1cnJlbnRUYXJnZXQsIHRoaXMuX2N1cnJlbnREaXJlY3Rpb24pO1xuICAgICAgfSlcbiAgfVxuXG4gIHNldFBvc2l0aW9uKHRhcmdldDogRWxlbWVudFJlZiwgZGlyZWN0aW9uQ29kZTogRElSRUNUSU9OUyA9IERJUkVDVElPTlMuYm90dG9tKSB7XG4gICAgaWYgKCF0YXJnZXQpIHtcbiAgICAgIHJldHVybiBjb25zb2xlLmVycm9yKCdFbW9qaS1QaWNrZXI6IHBvc2l0aW9uaW5nIGZhaWxlZCBkdWUgdG8gbWlzc2luZyB0YXJnZXQgZWxlbWVudCBvciBkaXJlY3Rpb24gY29kZScpO1xuICAgIH1cblxuICAgIHRoaXMuX3JlbmRlcmVyLnNldEVsZW1lbnRTdHlsZSh0aGlzLl9lbC5uYXRpdmVFbGVtZW50LCAndHJhbnNmb3JtJywgJycpO1xuXG4gICAgLyoqIFN0b3JlIGFuY2hvciBhbmQgZGlyZWN0aW9uICovXG4gICAgdGhpcy5fY3VycmVudFRhcmdldCA9IHRhcmdldDtcbiAgICB0aGlzLl9jdXJyZW50RGlyZWN0aW9uID0gZGlyZWN0aW9uQ29kZTtcblxuICAgIGNvbnN0IHRhcmdldEJvcmRlcnMgPSB0YXJnZXQubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcbiAgICAgIHRoaXNCb3JkZXJzID0gdGhpcy5fZWwubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgIGxldCBoZWlnaHRDb3JyZWN0aW9uID0gMCwgd2lkdGhDb3JyZWN0aW9uID0gMDtcblxuICAgIC8qKiBTZXR0aW5nIHVwIGNlbnRlcmluZyBvZiBwaWNrZXIgZm9yIGFsbCBjYXNlcyAqL1xuICAgIHN3aXRjaCAodGhpcy5fY3VycmVudERpcmVjdGlvbikge1xuICAgICAgY2FzZSBESVJFQ1RJT05TLnRvcDpcbiAgICAgIGNhc2UgRElSRUNUSU9OUy5ib3R0b206XG4gICAgICAgIHdpZHRoQ29ycmVjdGlvbiA9IHRhcmdldEJvcmRlcnMubGVmdCAtIHRoaXNCb3JkZXJzLmxlZnQgKyAodGFyZ2V0Qm9yZGVycy53aWR0aCAtIHRoaXNCb3JkZXJzLndpZHRoKSAvIDI7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBESVJFQ1RJT05TLmxlZnQ6XG4gICAgICBjYXNlIERJUkVDVElPTlMucmlnaHQ6XG4gICAgICAgIGhlaWdodENvcnJlY3Rpb24gPSB0YXJnZXRCb3JkZXJzLnRvcCAtIHRoaXNCb3JkZXJzLnRvcCArICh0YXJnZXRCb3JkZXJzLmhlaWdodCAtIHRoaXNCb3JkZXJzLmhlaWdodCkgLyAyO1xuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICAvKiogU2V0dGluZyB1cCByZWxhdGl2ZSBwb3NpdGlvbmluZyBmb3IgYWxsIGNhc2VzICovXG4gICAgc3dpdGNoICh0aGlzLl9jdXJyZW50RGlyZWN0aW9uKSB7XG4gICAgICBjYXNlIERJUkVDVElPTlMudG9wOlxuICAgICAgICBoZWlnaHRDb3JyZWN0aW9uID0gdGFyZ2V0Qm9yZGVycy50b3AgLSB0aGlzQm9yZGVycy5ib3R0b207XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBESVJFQ1RJT05TLmxlZnQ6XG4gICAgICAgIHdpZHRoQ29ycmVjdGlvbiA9IHRhcmdldEJvcmRlcnMubGVmdCAtIHRoaXNCb3JkZXJzLnJpZ2h0O1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgRElSRUNUSU9OUy5yaWdodDpcbiAgICAgICAgd2lkdGhDb3JyZWN0aW9uID0gdGFyZ2V0Qm9yZGVycy5yaWdodCAtIHRoaXNCb3JkZXJzLmxlZnQ7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBESVJFQ1RJT05TLmJvdHRvbTpcbiAgICAgICAgaGVpZ2h0Q29ycmVjdGlvbiA9IHRhcmdldEJvcmRlcnMuYm90dG9tIC0gdGhpc0JvcmRlcnMudG9wO1xuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICAvKiogQ29ycmVjdGluZyBwb3NpdGlvbmluZyBkdWUgdG8gb3ZlcmZsb3cgcHJvYmxlbXMgKi9cbiAgICBpZiAodGhpc0JvcmRlcnMuYm90dG9tICsgaGVpZ2h0Q29ycmVjdGlvbiA+IHdpbmRvdy5pbm5lckhlaWdodCkge1xuICAgICAgaGVpZ2h0Q29ycmVjdGlvbiArPSB3aW5kb3cuaW5uZXJIZWlnaHQgLSAodGhpc0JvcmRlcnMuYm90dG9tICsgaGVpZ2h0Q29ycmVjdGlvbik7XG4gICAgfVxuXG4gICAgaWYgKHRoaXNCb3JkZXJzLnRvcCArIGhlaWdodENvcnJlY3Rpb24gPCAwKSB7XG4gICAgICBoZWlnaHRDb3JyZWN0aW9uIC09ICh0aGlzQm9yZGVycy50b3AgKyBoZWlnaHRDb3JyZWN0aW9uKTtcbiAgICB9XG5cbiAgICBpZiAodGhpc0JvcmRlcnMucmlnaHQgKyB3aWR0aENvcnJlY3Rpb24gPiB3aW5kb3cuaW5uZXJXaWR0aCkge1xuICAgICAgd2lkdGhDb3JyZWN0aW9uICs9IHdpbmRvdy5pbm5lcldpZHRoIC0gKHRoaXNCb3JkZXJzLnJpZ2h0ICsgd2lkdGhDb3JyZWN0aW9uKTtcbiAgICB9XG5cbiAgICBpZiAodGhpc0JvcmRlcnMubGVmdCArIHdpZHRoQ29ycmVjdGlvbiA8IDApIHtcbiAgICAgIHdpZHRoQ29ycmVjdGlvbiAtPSAodGhpc0JvcmRlcnMubGVmdCArIHdpZHRoQ29ycmVjdGlvbik7XG4gICAgfVxuICAgIFxuICAgIC8qKiBzZXQgdGhlIHBvc2l0aW9uIGFkanVzdG1lbnRzIHRvIHRoZSBlbW9qaSBwaWNrZXIgZWxlbWVudCAqL1xuICAgIHRoaXMuX3JlbmRlcmVyLnNldEVsZW1lbnRTdHlsZSh0aGlzLl9lbC5uYXRpdmVFbGVtZW50LCAndHJhbnNmb3JtJywgYHRyYW5zbGF0ZSgke3dpZHRoQ29ycmVjdGlvbn1weCwke2hlaWdodENvcnJlY3Rpb259cHgpYCk7XG4gIH1cblxuICBvbkJhY2tncm91bmQoZXZlbnQpIHtcbiAgICAvKiogaW50ZXJuYWwgbW91c2Vkb3ducyBhcmUgaWdub3JlZCAqL1xuICAgIGlmIChldmVudCA9PT0gdGhpcy5fbGFzdEhvc3RNb3VzZWRvd25FdmVudCB8fCBldmVudC5lbW9qaVBpY2tlckV4ZW1wdCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMucGlja2VyQ2xvc2VFbWl0dGVyLmVtaXQoZXZlbnQpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5fZGVzdHJveWVkLm5leHQodHJ1ZSk7XG4gIH1cbn1cbiJdfQ==